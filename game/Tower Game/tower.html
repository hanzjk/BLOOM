<!DOCTYPE html>
<html>
<link rel="stylesheet" href="towertest.css">
<link href="https://fonts.googleapis.com/css2?family=Grandstander:ital,wght@1,900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Grandstander:ital,wght@1,900&family=Satisfy&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Henny+Penny&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no,minimal-ui">
    <title>Tower Game</title>

</head>

<body>

    <div class="heading">TOWER GAME</div>

    <div class="icon-bar">
            <a href="../../index.html"><i class="fa fa-home"></i></a>
            <a href="../../games.html"><i class="fa fa-gamepad"></i></a>
            <a href="../../Music/emotiondetect.html"><i class="fa fa-music"></i></a>
            <a href="../../chatbot.html"><i class="fa fa-comments"></i></a>
    </div>

    <div class="content">

        <div class="Help"><img id="help" src="./assets/helpbtn.png">
            <span class="tooltiptext"><p>
                <br>Build up the tower as high as you can.<br>
                <br>Click to release a swinging block from the hook. <br>
                <br>Try to drop the block right on to the block below. <br>
                <br>The stacking becomes more difficult over time because the 
                tower module will swing faster wildly as the game progresses. <br>
                <br>Mis-drops will cost you in lives! <br>
                <br>Good Luck! </p></span>

        </div>

        <canvas id="canvas" class="hide"></canvas>
        <div class="loading">
            <div class="main"><img src="./assets/main-loading.gif">
                <div class="progress">
                    <div class="title font-wenxue">0%</div>
                    <div class="bar">
                        <div class="sub">
                            <div class="percent"></div>
                        </div>
                    </div>
                    <div class="text">Loading....</div>
                </div>
            </div>

        </div>

        <div class="landing hide">

            <div class="action-1">
                <img src="./assets/main-index-title (1).png" class="title swing">
            </div>
            <div class="action-2"><img id="start" src="./assets/playbutton.png" class="start"></div>

        </div>
        <div id="modal" class="modal hide">


            <div class="js-modal-content modal-content">
                <div class="main">

                    <div class="container">
                        <div class="modal-main">
                            <div id="over-modal" class="hide js-modal-card">
                                <div class="tip">
                                    GAME OVER
                                    <br>your score:<br>
                                    <img src="./assets/playagain.png" class="over-button-b js-reload">


                                </div>
                                <div id="score" class="over-score font-wenxue"></div>
                                <div id="over-zero" class="hide">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <script src="./dist/main.js"></script>
        <script src="./assets/zepto-1.1.6.min.js"></script>
        <script>
            var domReady, loadFinish, canvasReady, loadError, gameStart, game, score, successCount
                // init window height and width
            var gameWidth = window.innerWidth
            var gameHeight = window.innerHeight
            var ratio = 1.1
            if (gameHeight / gameWidth < ratio) {
                gameWidth = Math.ceil(gameHeight / ratio)
            }
            $('.content').css({
                "height": gameHeight + "px",
                "width": gameWidth + "px"
            })
            $('.js-modal-content').css({
                "width": gameWidth + "px"
            })

            // loading animation
            function hideLoading() {
                if (domReady && canvasReady) {
                    $('#canvas').show()
                    loadFinish = true
                    setTimeout(function() {
                        $('.loading').hide()
                        $('.landing').show()
                    }, 1000)
                }
            }

            function updateLoading(status) {
                var success = status.success
                var total = status.total
                var failed = status.failed
                if (failed > 0 && !loadError) {
                    loadError = true
                    alert('error')
                    return
                }
                var percent = parseInt((success / total) * 100);
                if (percent === 100 && !canvasReady) {
                    canvasReady = true
                    hideLoading()
                }
                percent = percent > 98 ? 98 : percent
                percent = percent + '%'
                $('.loading .title').text(percent);
                $('.loading .percent').css({
                    'width': percent
                })
            }

            function overShowOver() {
                $('#modal').show()
                $('#over-modal').show()
                $('#over-zero').show()
            }

            // game customization options
            const option = {
                width: gameWidth,
                height: gameHeight,
                canvasId: 'canvas',
                soundOn: true,
                setGameScore: function(s) {
                    score = s
                },
                setGameSuccess: function(s) {
                    successCount = s
                },
                setGameFailed: function(f) {
                    $('#score').text(score)
                    if (f >= 3) overShowOver()
                }
            }

            // game init with option
            function gameReady() {
                game = TowerGame(option)

                game.load(function() {

                    game.playBgm()
                    game.init()

                }, updateLoading)
            }

            var isWechat = navigator.userAgent.toLowerCase().indexOf("micromessenger") !== -1
            if (isWechat) {
                document.addEventListener("WeixinJSBridgeReady", gameReady, false)
            } else {
                gameReady()
            }

            function indexHide() {
                $('.landing .action-1').addClass('slideTop')
                $('.landing .action-2').addClass('slideBottom')
                setTimeout(function() {
                    $('.landing').hide()
                }, 950)
            }

            // click event
            $('#start').on('click', function() {
                if (gameStart) return
                gameStart = true
                indexHide()
                setTimeout(game.start, 400)
            })

            $('.js-reload').on('click', function() {
                window.location.href = window.location.href + '?s=' + (+new Date())
            })

            $('.js-invite').on('click', function() {
                $('.wxShare').show()
            })

            $('.wxShare').on('click', function() {
                $('.wxShare').hide()
            })

            // listener
            window.addEventListener('load', function() {
                domReady = true
                hideLoading()
            }, false);
        </script>
        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-46444752-20', 'auto');
            ga('send', 'pageview');

            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?c1b044f909411ac4213045f0478e96fc";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
        <script>
            function resize() {
                $("#viewport").outerHeight($(window).height() - $("#viewport").offset().top - Math.abs($("#viewport").outerHeight(true) - $("#viewport").outerHeight()));
            }
            $(document).ready(function() {
                resize();
                $(window).on("resize", function() {
                    resize();
                });
            });
        </script>
</body>

</html>